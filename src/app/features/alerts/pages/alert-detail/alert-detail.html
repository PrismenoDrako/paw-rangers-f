<div class="alert-detail" [ngClass]="{ 'is-found': alert?.reportType === 'found' }">
  <button class="link-back" type="button" (click)="backToNotifications()">
    <i class="pi pi-arrow-left"></i>
    Volver a notificaciones
  </button>

  <ng-container *ngIf="alert; else notFound">
    <div class="hero-card">
      <div class="hero-content">
        <div class="pill-row hero-badges">
          <span class="pill pill--status" [class.pill--open]="alert.status === 'open'" [class.pill--resolved]="alert.status === 'resolved'">
            {{ alert.status === 'open' ? 'Alerta abierta' : 'Resuelta' }}
          </span>
          <span class="pill pill--type">{{ alert.reportType === 'lost' ? 'Mascota perdida' : 'Mascota encontrada' }}</span>
          <span class="pill pill--id">ID: {{ alert.reportId }}</span>
        </div>

        <h1 class="hero-title">{{ alert.title.replace('Mascota perdida: ', '').replace('Mascota encontrada: ', '') }}</h1>
        <p class="hero-subtitle">
          {{ alert.reportType === 'lost' ? 'Perdida Â· alerta urgente' : 'Encontrada Â· requiere contacto' }}
        </p>

        <p class="hero-description">{{ alert.description }}</p>

        <div class="hero-actions">
          <a
            *ngIf="contactPet?.contactInfo?.phone"
            class="btn primary"
            [href]="'tel:' + contactPet?.contactInfo?.phone">
            ðŸ“ž {{ contactButtonLabel }}
          </a>
          <button class="btn ghost" type="button" (click)="openInMap()">Ver en mapa</button>
          <button class="btn ghost" type="button" (click)="goToReport()">Ver reporte completo</button>
          <div class="status-menu" *ngIf="alert?.ownedByCurrentUser">
            <button type="button" class="btn ghost" (click)="toggleStatusMenu()">Marcar reporte</button>
            <div class="status-dropdown" *ngIf="showStatusMenu">
              <button type="button" (click)="markResolved()">Marcar como resuelta</button>
              <button type="button" (click)="markInFollowUp()">Dejar en seguimiento</button>
            </div>
          </div>
        </div>

        <div class="quick-meta" *ngIf="alert.lastSeen || alert.createdAt">
          <div class="chip" *ngIf="alert.lastSeen?.label">
            <i class="pi pi-map-marker"></i>
            <span>Ãšltima vez vista: {{ alert.lastSeen?.label }}</span>
          </div>
          <div class="chip" *ngIf="alert.createdAt">
            <i class="pi pi-clock"></i>
            <span>{{ alert.createdAt | date:'MMM d, h:mm a' }}</span>
          </div>
        </div>
      </div>

      <div class="hero-image" *ngIf="alert.image">
        <img [src]="alert.image" [alt]="alert.title" />
      </div>
    </div>

    <div class="alert-layout">
      <div class="alert-layout__column">
        <div class="alert-section alert-photos" *ngIf="alert.reportType === 'found' && alert.foundImage">
          <div class="photo-card">
            <p class="photo-label">Foto encontrada</p>
            <img [src]="alert.foundImage" [alt]="alert.title + ' encontrada'" />
          </div>
        </div>

        <div class="alert-section contact-section" *ngIf="alert.reportType === 'lost' && alert.ownerContact">
          <h3>Contacto</h3>
          <div class="contact-card">
            <div class="contact-row">
              <div class="contact-icon"><i class="pi pi-user"></i></div>
              <div class="contact-text">
                <span class="contact-label">DueÃ±o</span>
                <span class="contact-value">{{ alert.ownerContact.name }}</span>
              </div>
            </div>
            <div class="contact-row" *ngIf="alert.ownerContact.phone">
              <div class="contact-icon"><i class="pi pi-phone"></i></div>
              <div class="contact-text">
                <span class="contact-label">TelÃ©fono</span>
                <a [href]="'tel:' + alert.ownerContact.phone" class="contact-link">{{ alert.ownerContact.phone }}</a>
              </div>
            </div>
            <div class="contact-row" *ngIf="alert.ownerContact.email">
              <div class="contact-icon"><i class="pi pi-envelope"></i></div>
              <div class="contact-text">
                <span class="contact-label">Correo</span>
                <a [href]="'mailto:' + alert.ownerContact.email" class="contact-link">{{ alert.ownerContact.email }}</a>
              </div>
            </div>
            <div class="contact-row" *ngIf="alert.location">
              <div class="contact-icon"><i class="pi pi-map"></i></div>
              <div class="contact-text">
                <span class="contact-label">Zona</span>
                <span class="contact-value">{{ alert.location }}</span>
              </div>
            </div>
            <div class="contact-actions">
              <a *ngIf="alert.ownerContact.phone" [href]="'tel:' + alert.ownerContact.phone" class="btn primary">Llamar</a>
              <a *ngIf="alert.ownerContact.email" [href]="'mailto:' + alert.ownerContact.email" class="btn ghost">Correo</a>
            </div>
          </div>
        </div>

        <div class="alert-section">
          <h3>Eventos</h3>
          <app-alert-timeline [events]="alert.timeline || []"></app-alert-timeline>
        </div>
      </div>

      <div class="alert-layout__column alert-layout__column--map" *ngIf="alert.lastSeen">
        <div class="alert-section">
          <h3>Zona de avistamiento</h3>
          <app-alert-map
            [center]="{ lat: alert.lastSeen.lat, lng: alert.lastSeen.lng }"
            [radiusMeters]="alert.lastSeen.radiusMeters || 300"
            [markers]="timelineMarkers">
          </app-alert-map>
        </div>
      </div>
    </div>
  </ng-container>

  <ng-template #notFound>
    <p class="empty">No se encontrÃ³ esta alerta.</p>
  </ng-template>
</div>

<app-lost-contact-modal
  [showContactModal]="showContactModal"
  [selectedPet]="contactPet"
  (onClose)="closeContactModal()"
  (onCallOwner)="callOwner($event)">
</app-lost-contact-modal>
