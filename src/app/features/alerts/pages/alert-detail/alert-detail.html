<div class="alert-detail">
  <button class="link-back" type="button" (click)="backToNotifications()">
    <i class="pi pi-arrow-left"></i>
    Volver a notificaciones
  </button>

  <ng-container *ngIf="alert; else notFound">
    <div class="alert-hero">
      <div class="alert-hero__image" *ngIf="alert.image">
        <img [src]="alert.image" [alt]="alert.title" />
      </div>

      <div class="pill-row hero-badges">
        <span class="pill pill--type">{{ alert.reportType === 'lost' ? 'Mascota perdida' : 'Mascota encontrada' }}</span>
        <span class="pill">ID reporte: {{ alert.reportId }}</span>
        <span class="pill pill--status" [class.pill--open]="alert.status === 'open'" [class.pill--resolved]="alert.status === 'resolved'">
          Estado: {{ alert.status === 'open' ? 'Abierta' : 'Resuelta' }}
        </span>
      </div>

      <div class="hero-main">
        <app-alert-summary
          [alert]="alert"
          [showActions]="true"
          (viewReport)="goToReport()"
          (markResolved)="markResolved()">
        </app-alert-summary>
      </div>
    </div>

    <div class="alert-meta" *ngIf="alert.location || alert.lastSeen || alert.createdAt">
      <div class="meta-card" *ngIf="alert.location">
        <p class="meta-label">Ubicaci칩n reportada</p>
        <p class="meta-value">{{ alert.location }}</p>
      </div>
      <div class="meta-card" *ngIf="alert.lastSeen?.label">
        <p class="meta-label">Lugar de avistamiento</p>
        <p class="meta-value">{{ alert.lastSeen?.label }}</p>
      </div>
      <div class="meta-card" *ngIf="alert.createdAt">
        <p class="meta-label">Creado</p>
        <p class="meta-value">{{ alert.createdAt | date:'medium' }}</p>
      </div>
    </div>

    <div class="alert-layout">
      <div class="alert-layout__column">
        <div class="alert-section alert-photos" *ngIf="alert.reportType === 'found' && alert.foundImage">
          <div class="photo-card">
            <p class="photo-label">Foto encontrada</p>
            <img [src]="alert.foundImage" [alt]="alert.title + ' encontrada'" />
          </div>
        </div>

        <div class="alert-section" *ngIf="alert.reportType === 'lost' && alert.ownerContact">
          <h3>Contacto</h3>
          <div class="contact-card">
            <h4 class="contact-owner">
              <span class="contact-owner__label">Due침o:</span>
              <span class="contact-owner__name">{{ alert.ownerContact.name }}</span>
            </h4>
            <p *ngIf="alert.ownerContact.note" class="contact-note">{{ alert.ownerContact.note }}</p>
            <div class="contact-meta">
              <p *ngIf="alert.ownerContact.address" class="contact-meta__item">
                <span class="contact-meta__label">Direcci칩n:</span>
                <span>{{ alert.ownerContact.address }}</span>
              </p>
              <p *ngIf="alert.location" class="contact-meta__item">
                <span class="contact-meta__label">Zona:</span>
                <span>{{ alert.location }}</span>
              </p>
            </div>
            <div class="contact-actions">
              <a *ngIf="alert.ownerContact.phone" [href]="'tel:' + alert.ownerContact.phone" class="btn">Llamar</a>
              <a *ngIf="alert.ownerContact.email" [href]="'mailto:' + alert.ownerContact.email" class="btn ghost">Correo</a>
            </div>
          </div>
        </div>

        <div class="alert-section">
          <h3>Eventos</h3>
          <app-alert-timeline [events]="alert.timeline || []"></app-alert-timeline>
        </div>
      </div>

      <div class="alert-layout__column alert-layout__column--map" *ngIf="alert.lastSeen">
        <div class="alert-section">
          <h3>Zona de avistamiento</h3>
          <app-alert-map
            [center]="{ lat: alert.lastSeen.lat, lng: alert.lastSeen.lng }"
            [radiusMeters]="alert.lastSeen.radiusMeters || 300"
            [markers]="timelineMarkers">
          </app-alert-map>
        </div>
      </div>
    </div>
  </ng-container>

  <ng-template #notFound>
    <p class="empty">No se encontr칩 esta alerta.</p>
  </ng-template>
</div>
