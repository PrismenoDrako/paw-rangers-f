<p-card [header]="isEditMode ? 'Editar Mascota: ' + (petData?.name || petForm.get('name')?.value) : 'Crear Mascota'"
    styleClass="w-full shadow-lg rounded-xl surface-card">
    <form [formGroup]="petForm" (ngSubmit)="savePet()" class="p-fluid grid form-layout">

        <div class="field col-12">
            <label for="name">Nombre</label>
            <input pInputText id="name" type="text" formControlName="name" />
        </div>

        <div class="field col-12 md:col-6">
            <label for="species">Especie</label>
            <select id="species" formControlName="species" class="p-inputtext" (change)="onSpeciesChange(petForm.get('species')?.value)">
                <option [ngValue]="null" disabled selected>Selecciona una especie</option>
                <option *ngFor="let option of speciesOptions" [ngValue]="option">
                    {{ option.name }}
                </option>
            </select>
        </div>
        
        <div *ngIf="petForm.get('species')?.value?.code === 'OTHER'" class="field col-12 md:col-6">
            <label for="customSpecies">Especifica la especie</label>
            <input pInputText id="customSpecies" type="text" formControlName="customSpecies" />
        </div>

        <div class="field col-12 md:col-6">
            <label for="breed">Raza</label>
            <select id="breed" formControlName="breed" class="p-inputtext" [disabled]="filteredBreeds.length === 0">
                <option [ngValue]="null" disabled selected>Selecciona una raza</option>
                <option *ngFor="let option of filteredBreeds" [ngValue]="option">
                    {{ option.name }}
                </option>
            </select>
        </div>
        
        <div *ngIf="petForm.get('breed')?.value?.code === 'OTHER'" class="field col-12 md:col-6">
            <label for="customBreed">Especifica la raza</label>
            <input pInputText id="customBreed" type="text" formControlName="customBreed" />
        </div>

        <div class="field col-12 md:col-6 select-button-container">
            <label>Género</label>
            <p-selectButton [options]="genderOptions" formControlName="gender" optionLabel="label" optionValue="value">
                <ng-template let-item pTemplate>
                    <i [class]="item.icon" class="mr-2"></i>
                    <span>{{item.label}}</span>
                </ng-template>
            </p-selectButton>
        </div>

        <div class="field col-12 md:col-6">
            <label for="age">Edad (Años)</label>
            <p-inputNumber id="age" formControlName="age" mode="decimal" [min]="0" [showButtons]="true" inputId="age"></p-inputNumber>
        </div>

        <div class="field col-12">
            <label for="fileUpload">Foto (Opcional)</label>
            <div class="file-upload-wrapper">
                <input #fileInput type="file" id="fileUpload" accept="image/*" (change)="onImageUpload($event)" class="file-input-hidden" />
                <p-button label="Elegir Archivo" icon="pi pi-upload" styleClass="p-button-primary p-button-raised" (onClick)="fileInput.click()"></p-button>
            </div>
        </div>

        <div class="col-12 text-center mb-3">
            <img *ngIf="localImageUrl" [src]="localImageUrl" alt="Imagen de la Mascota" class="preview-image shadow-md" />
            <i *ngIf="!localImageUrl" class="pi pi-fw pi-paw pet-icon"></i>
        </div>

        <div class="col-12 flex justify-content-center gap-2 mt-3 form-actions">
            <p-button type="submit" [label]="isEditMode ? 'Guardar Cambios' : 'Añadir Mascota'" icon="pi pi-save"
                styleClass="p-button-primary p-button-raised"></p-button>
            
            <p-button *ngIf="isEditMode" type="button" label="Eliminar Mascota" icon="pi pi-trash"
                styleClass="p-button-danger p-button-raised" (onClick)="deletePet()"></p-button>
                
            <p-button type="button" label="Cancelar" icon="pi pi-times" styleClass="p-button-outlined p-button-primary p-button-raised"
                (onClick)="cancel()"></p-button>
        </div>
    </form>
</p-card>

<p-confirmDialog></p-confirmDialog>